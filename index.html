<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal de Archivos — SISCTE</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<nav>
  <div class="nav-logo">
    <div class="nav-logo-ico">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
      </svg>
    </div>
    Portal de Archivos — SISCTE
  </div>
  <div class="nav-right">
    <div id="nav-sesion" style="display:none;align-items:center;gap:8px;">
      <button class="nav-btn active" id="nb-subir">Subir archivo</button>
      <button class="nav-btn" id="nb-admin" style="display:none">Administración</button>
      <img id="nav-foto" class="nav-foto" src="" alt="">
      <span id="nav-nombre" class="nav-nombre"></span>
      <button class="btn-out btn-logout">Salir</button>
    </div>
    <div id="nav-guest" style="display:flex;align-items:center;">
      <span style="font-size:13px;color:var(--txt2);">Inicia sesión para continuar</span>
    </div>
  </div>
</nav>

<main>

  <!-- LOGIN -->
  <div class="centro" id="vista-login">
    <div class="card">
      <div class="card-ico">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/>
          <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
      </div>
      <h2>Bienvenido</h2>
      <p class="card-sub">Inicia sesión con tu cuenta de Google para subir tu archivo. Tu nombre, correo, fecha y hora quedarán registrados automáticamente.</p>
      <button class="btn-google" id="btn-google">
        <svg width="18" height="18" viewBox="0 0 48 48">
          <path fill="#FFC107" d="M43.6 20H24v8h11.3C33.6 33.1 29.3 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3 0 5.7 1.1 7.8 2.9l5.7-5.7C33.8 6.5 29.1 4.5 24 4.5 12.7 4.5 3.5 13.7 3.5 25S12.7 45.5 24 45.5c11 0 20.5-8 20.5-20.5 0-1.4-.1-2.7-.4-3.5z"/>
          <path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.6 15.1 19 12 24 12c3 0 5.7 1.1 7.8 2.9l5.7-5.7C33.8 6.5 29.1 4.5 24 4.5c-7.7 0-14.3 4.4-17.7 10.2z"/>
          <path fill="#4CAF50" d="M24 45.5c5 0 9.6-1.9 13.1-5l-6.1-5.1C29.1 37 26.6 38 24 38c-5.2 0-9.6-2.9-11.3-7.1l-6.5 5C9.6 41 16.4 45.5 24 45.5z"/>
          <path fill="#1976D2" d="M43.6 20H24v8h11.3c-.8 2.3-2.3 4.2-4.2 5.6l6.1 5.1C40.7 35.4 44 30.6 44 25c0-1.4-.1-2.7-.4-3.5z"/>
        </svg>
        Acceder con Google
      </button>
      <div class="info-box">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#1d4ed8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;margin-top:1px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        <span>Cualquier cuenta de Google válida puede ingresar y subir archivos. Google verifica tu identidad automáticamente.</span>
      </div>
    </div>
  </div>

  <!-- SUBIR -->
  <div class="centro" id="vista-subir">
    <div class="card">
      <h2 style="font-size:18px;margin-bottom:16px">Subir archivo Excel</h2>
      <div class="user-bar">
        <img id="up-foto" src="" alt="">
        <div>
          <div class="ub-nombre" id="up-nombre"></div>
          <div class="ub-email"  id="up-email"></div>
        </div>
      </div>
      <div id="dropzone">
        <div class="dz-ico">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <div class="dz-title">Arrastra tu archivo aquí</div>
        <div class="dz-sub">o haz clic para seleccionar desde tu dispositivo</div>
        <div class="dz-tags">
          <span class="dz-tag">.xlsx</span>
          <span class="dz-tag">.xls</span>
        </div>
      </div>
      <input type="file" id="file-input" accept=".xlsx,.xls">
      <div id="file-preview">
        <div class="fp-ico">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        </div>
        <div class="fp-data">
          <div id="fp-nombre"></div>
          <div id="fp-peso"></div>
        </div>
        <button id="btn-cambiar">Cambiar</button>
      </div>

      <!-- Barra de progreso -->
      <div id="progress-wrap">
        <div class="progress-label">
          <span>Subiendo archivo...</span>
          <span id="progress-txt">0%</span>
        </div>
        <div class="progress-track">
          <div id="progress-bar"></div>
        </div>
      </div>

      <button class="btn-primary" id="btn-enviar">Enviar archivo</button>
    </div>
  </div>

  <!-- ÉXITO -->
  <div class="centro" id="vista-exito">
    <div class="exito-card">
      <div class="exito-ico">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <h2>¡Archivo enviado!</h2>
      <p>Tu entrega quedó guardada en Firebase Storage y registrada en Firestore.</p>
      <div class="exito-grid">
        <div class="exito-item full"><label>Enviado por</label><span id="ex-nombre"></span></div>
        <div class="exito-item full"><label>Correo</label><span id="ex-email"></span></div>
        <div class="exito-item full"><label>Archivo</label><span id="ex-archivo"></span></div>
        <div class="exito-item"><label>Fecha</label><span id="ex-fecha"></span></div>
        <div class="exito-item"><label>Hora</label><span id="ex-hora"></span></div>
      </div>
      <button class="btn-otro" id="btn-enviar-otro">Enviar otro archivo</button>
    </div>
  </div>

  <!-- ADMIN -->
  <div class="centro" id="vista-admin">
    <div class="admin-wrap">
      <div class="admin-top">
        <div>
          <h2>Panel de administración</h2>
          <p>Registro de entregas · Firebase Storage + Firestore</p>
        </div>
        <div class="admin-acc">
          <button class="btn-excel" id="btn-excel">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Exportar informe Excel
          </button>
          <button class="btn-cerrar btn-logout">Cerrar sesión</button>
        </div>
      </div>

      <div class="stats">
        <div class="stat"><div class="stat-lbl">Total archivos recibidos</div><div class="stat-val" id="st-total">—</div></div>
        <div class="stat"><div class="stat-lbl">Personas que enviaron</div><div class="stat-val" id="st-unicos">—</div></div>
        <div class="stat full"><div class="stat-lbl">Último envío recibido</div><div class="stat-val" id="st-ultimo">—</div></div>
      </div>

      <div class="sec-title">Quiénes enviaron archivos</div>
      <div class="panel" style="margin-bottom:20px">
        <div class="panel-body">
          <div id="admin-personas"><p class="cargando-txt">Cargando...</p></div>
        </div>
      </div>

      <div class="sec-title">Todos los archivos recibidos</div>
      <div class="panel">
        <div style="overflow-x:auto">
          <table>
            <thead>
              <tr><th>#</th><th>Quien envió</th><th>Archivo</th><th>Peso</th><th>Fecha</th><th>Hora</th></tr>
            </thead>
            <tbody id="tabla-body">
              <tr><td colspan="6" class="td-vacio">Cargando datos...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</main>

<div class="toast" id="toast"></div>

<!-- Script al final del body para que el DOM esté listo -->
<script type="module" src="app.js"></script>

</body>
</html>
